<div class="trip__area <%= "finished" if @trip.goal %>">
  <div class="col-sm-6">
    <h1><%= @trip.title.truncate(35) %></h1>

    <hr>

    <p>
      <i class="fas fa-map-marker-alt"></i>
      <%= @country.name_jp %> / <%= @city.name_jp if @city.present? %>
    </p>

    <p>
      <i class="far fa-calendar-alt"></i>
      <%= @trip.start_on %> - <%= @trip.finish_on %>
      <% if @trip.flexible %>
        (<%= t('activerecord.attributes.trip.flexible') %>)
      <% end %>
    </p>

    <p class="content">
      <%= @trip.description %>
    </p>

    <p>
      <i class="fas fa-flag-checkered"></i>
      <% if @trip.goal %>
        終了済
      <% else %>
        募集中
      <% end %>
    </p>

    <p>
      <%= link_to profile_path(@trip.user.profile.id) do %>
        <%= image_tag @trip.user.profile.icon.url, class: "trip_icon"%>
        <%= @trip.user.name %>
      <% end %>
    </p>
  </div>

  <div class="col-sm-6">
    <!---map--->
  <p>Google Map</p>

  <p>From -- <%= @from.name_jp %>の緯度: <%= @from.latitude %> 経度:<%= @from.longitude %>
  <i class="flag-icon flag-icon-<%= @from.code.downcase %>"></i></p>
  <p>To -- <%= @to.name_jp %>の緯度: <%= @to.latitude %> 経度:<%= @to.longitude %>
  <i class="flag-icon flag-icon-<%= @to.code.downcase %>"></i></p>

  <p>距離 <%= @to.distance_to(@from) %></p>
  <p>中間地点 <%= @middle %></p>
  
  <div id="map"></div>

  <script>
    function initMap() {
      
      var from = { lat: <%= @from.latitude %>, lng: <%= @from.longitude %> };
      var to = { lat: <%= @to.latitude %>, lng: <%= @to.longitude %> };
      var middle = { lat: <%= @middle[0] %>, lng: <%= @middle[1] %> };

      // マップの設定
      var map = new google.maps.Map(document.getElementById("map"), {
        center: middle,
        zoom: 2,
      });

       //ピンを表示(2点)
      var markerFrom = new google.maps.Marker({
                    position: from,
                    map: map,
      });
      
      var markerTo= new google.maps.Marker({
                    position: to,
                    map: map,
                    animation: google.maps.Animation.BOUNCE,
               });

      // 吹き出し表示
      var userIcon = '<%= image_tag @trip.user.profile.icon.url, class: "map_icon"%>';
      var userName = '<%= @trip.user.name %>';

      var infowindow = new google.maps.InfoWindow({
          content: `<h6>${userIcon}${userName}</h6>`,
          anchor: markerFrom,
      });
      
    } 
  </script>

    <!---favorite--->
    <p>
      <i class="fas fa-star"></i>
      <%= @trip.favorites.count %>人がお気に入り
      <% unless @trip.user_id == current_user.id %>
        <% if @favorite.present? %>
          <%= link_to 'お気に入り済み', favorite_path(id: @favorite.id), method: :delete, class: 'btn btn-danger' %>
        <% else %>
          <%= link_to 'お気に入りする', favorites_path(trip_id: @trip.id), method: :post, class: 'btn btn-primary' %>
        <% end %>
      <% end %>
    </p>

    <!---member--->
    <p>
      <i class="fas fa-child"></i>
      <%= @members.count %>人が参加中 ( visiter:<%= @visiters %> / local:<%= @locals %> )
      <% unless @trip.user_id == current_user.id %>
        <% if @member.present? %>
          <%= link_to '参加中！！', member_path(id: @member.id), method: :delete, class: 'btn btn-danger' %>
        <% else %>
          <%= link_to '一緒に旅をする', members_path(trip_id: @trip.id, as: 1), method: :post, class: 'btn btn-primary' %>
          <%= link_to 'ローカルとして参加', members_path(trip_id: @trip.id, as: 2), method: :post, class: 'btn btn-primary' %>
        <% end %>
      <% end %>
    </p>

    <div class="list">
    <ul>
      <% @members.each do |member| %>
        <%= link_to profile_path(member.user.id) do %>
          <li><%= member.user.name %></li>
        <% end %>
      <% end %>
    </ul>  
    </div>

    <!-- 似ている掲示板-->
    <p><i class="fas fa-search"></i> You might also like : <%= @country.name_jp %>行きの他の旅行</p>
    <div class="list">
      <ul>
        <% @similar.each do |similar| %>
          <%= link_to trip_path(similar.id) do %>
            <li><%= similar.title %></li>
          <% end %>
        <% end %>
      </ul>
    </div>
  </div>

    <!---goal--->
    <% if @trip.user.id == current_user.id %>
      <% if @trip.goal %>
        <%= link_to "再開する", change_goal_trip_path(goal: false), method: :post, class: 'btn btn-sm btn-danger' %>
      <% else %>
        <%= link_to "終了する", change_goal_trip_path(goal: true), method: :post, class: 'btn btn-sm btn-primary' %>
      <% end %>
    <% end %>

    <!-- コメント一覧-->
    <div class="comment__area">
      <!-- このcomments_areaというHTMLのidを取得して、このdivの中にあるHTMLの要素をJavaScript（Ajax）で書き換え -->
      <div id="comments_area">
        <!-- 投稿されたコメント一覧をブログの詳細ページに表示するためのrender パーシャルを表示 comments/_index.html.erb -->
        <%= render partial: 'comments/index', locals: { comments: @comments, trip: @trip } %>
      </div>
      <!-- コメント入力欄をブログの詳細ページに表示するためのrender パーシャルを表示 comments/_form.html.erb -->
      <%= render partial: 'comments/form', locals: { comment: @comment, trip: @trip } %>
    </div>
  
  
</div>

<%= link_to 'Edit', edit_trip_path(@trip) %> |
<%= link_to 'Back', trips_path %>