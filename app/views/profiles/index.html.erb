<h1>Find your Travel mate</h1>

<%= search_form_for @q do |f| %>
  <%= f.label :home_country, '国名で検索' %>
  <%# <%= f.select :home_country_eq ,Profile.home_countries, {include_blank: '----------'} %> %>
<br>
  <%= f.label :first_language_or_second_language, '言語で検索' %>
  <%= f.select :first_language_or_second_language_eq ,Profile.first_languages, {include_blank: '----------'} %>

  <%= f.submit '検索' %>
<% end %>

<h5>登録ユーザーの国別数</h5>
<p><%= Place.group(:code).count.size %>の国と地域</p>
 <%= @chart_map %>
 <%= geo_chart @chart_map %>

<div class="cards">
	<% @profiles.each do |profile| %>
		<div class="profile__card">
			<i class="fas fa-crown"></i>
			<%= image_tag profile.icon.url %>
			<h3><%= profile.user.name %></h3>
			<h6>
				<%= profile.place.name_jp if profile.place.ancestry&.length == 1 %>
				<%= profile.place.parent.name_jp if profile.place.ancestry&.include?('/') %>
				/ 
				<%= profile.place.name_jp if profile.place.ancestry&.include?('/') %>
			</h6>
			<p>
				<%= (Date.today.strftime('%Y%m%d').to_i - profile.birthday.strftime('%Y%m%d').to_i) / 10000 if  profile.birthday.present? %>歳 
				<%= profile.gender %>
			</p>
			<div class="buttons">
				<%= link_to 'Detail', profile, class: "btn btn-info"%>
				<%= link_to 'Message', talks_path(sender_id: current_user.id, receiver_id: profile.user.id), method: :post, class: "btn btn-warning" %>
			</div>
			<div class="profile__detail">
				<p>Language: <%= profile.first_language %> <%= profile.second_language %></p>
				<p><%= profile.introduction.truncate(20) if profile.introduction.present? %></p>
			</div>
		</div>
	<% end %>
</div>